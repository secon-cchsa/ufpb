<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gráfico de Pizza - Valor Adquirido Total</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: #333;
    }
    .chart-container {
      width: 100%;
      height: 100%;
      padding: 0;
      background-color: transparent;
      box-shadow: none;
      border-radius: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    h1 {
      color: white; /* Mantido como 'white' do seu original */
      margin-bottom: 10px;
      font-size: 1.2em;
      text-align: center;
    }
    canvas {
      max-width: 100%;
      max-height: calc(100% - 30px);
    }
  </style>
</head>
<body>
  <div class="chart-container">
    <h1>Principais itens adquiridos</h1>
    <canvas id="meuGraficoDePizza"></canvas>
  </div>

  <script>
    // --- NOVOS DADOS ---
    // Rótulos baseados na coluna "Descrição"
    const labels = [
        'Nissan Frontier SE 2023',
        'Impressora',
        'Ovinos Crescimento Master, 40 kg',
        'Ração Suino, fase reprodução',
        'Master Leite 22, 40kg',
        'Agua mineral, 20 Litros'
    ];
    
    // Valores numéricos baseados na coluna "Valor Adquirido Total"
    // (Convertidos de 'R$189.132,00' para 189132.00)
    const valores = [
        481800.00,
        189132.00,
        112288.00,
        85297.50,
        84960.00,
        76284.00
    ];
    // --- FIM DOS NOVOS DADOS ---

    // Paleta de cores ajustada para 6 itens (baseada na sua paleta original)
    const cores = [
        '#3182bd', '#6baed6', '#9ecae1', '#c6dbef', '#e6f0ff', '#f7fbff'
    ];
    
    let offsets = new Array(labels.length).fill(0);
    const offsetAmount = 100;

    const dadosGrafico = {
        labels: labels,
        datasets: [{
            label: 'Valor Adquirido Total', // Label do dataset atualizado
            data: valores,
            backgroundColor: cores,
            borderWidth: 1,
            borderColor: '#fff',
            hoverOffset: 10,
            offset: offsets
        }]
    };

    const config = {
        type: 'pie',
        data: dadosGrafico,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            onClick: (e, elements) => {
                if (elements.length > 0) {
                    const clickedElementIndex = elements[0].index;
                    
                    // Reseta todos os offsets antes de aplicar o novo
                    const currentOffset = offsets[clickedElementIndex];
                    offsets.fill(0); // Reseta todos
                    
                    if (currentOffset === 0) {
                        offsets[clickedElementIndex] = offsetAmount;
                    }
                    // Se já estava clicado (currentOffset !== 0), ele já foi resetado para 0
                    
                    meuGraficoDePizza.update();
                }
            },
            plugins: {
                // Adicionado para formatar o valor como R$
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed !== null) {
                                // Formata o valor como moeda BRL
                                label += new Intl.NumberFormat('pt-BR', {
                                    style: 'currency',
                                    currency: 'BRL'
                                }).format(context.parsed);
                            }
                            return label;
                        }
                    }
                },
                legend: {
                    position: 'top',
                    labels: {
                        color: 'white' // Mantido como 'white' do seu original
                    }
                },
                title: {
                    display: true,
                    text: '', // Título principal já está no H1
                    font: {
                        size: 18,
                        color: 'white'
                    }
                }
            }
        }
    };

    const meuGraficoDePizza = new Chart(
        document.getElementById('meuGraficoDePizza'),
        config
    );
  </script>
</body>
</html>
